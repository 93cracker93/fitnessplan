<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitnessplan</title>
<style>
  body {
    background-color: #121212;
    color: #e0e0e0;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 1rem;
  }
  .header-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  h1 {
    margin: 0;
    color: #f5a623;
    font-size: 1.6rem;
  }
  #reset-storage-button {
    background-color: #f5a623;
    color: #121212;
    border: none;
    border-radius: 4px;
    padding: 0.25rem 0.75rem;
    font-weight: bold;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background-color 0.3s;
  }
  #reset-storage-button:hover,
  #reset-storage-button:focus {
    background-color: #e09e1f;
    outline: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
    table-layout: fixed;
  }
  thead {
    background-color: #1e1e1e;
  }
  th, td {
    padding: 0.4rem 0.5rem;
    text-align: left;
    vertical-align: middle;
    overflow: hidden;
    white-space: normal;
    word-wrap: break-word;
    text-overflow: ellipsis;
  }
  th {
    border-bottom: 2px solid #f5a623;
    font-weight: 600;
  }
  tbody tr:nth-child(odd) {
    background-color: #222;
    color: #e0e0e0;
  }
  tbody tr:nth-child(even) {
    background-color: #1c1c1c;
    color: #e0e0e0;
  }
  th:nth-child(1), td:nth-child(1) {
    width: 25%;
  }
  th:nth-child(2), td:nth-child(2) {
    width: 14%;
  }
  th:nth-child(3), td:nth-child(3) {
    width: 14%;
  }
  th:nth-child(4), td:nth-child(4) {
    width: 15%;
  }
  th:nth-child(5), td:nth-child(5) {
    width: 12%;
    text-align: center;
  }
  @media (max-width: 600px) {
    body {
      padding: 0.5rem;
      font-size: 0.9rem;
    }
    .header-container {
      flex-direction: column;
      gap: 0.5rem;
    }
    h1 {
      font-size: 1.3rem;
    }
    #reset-storage-button {
      width: 100%;
      font-size: 1rem;
    }
    table {
      font-size: 0.75rem;
      width: 100%;
      border-spacing: 0;
      table-layout: auto;
    }
    thead {
      display: flex;
      flex-wrap: nowrap; /* Keine Umbrüche! */
      background-color: #1e1e1e;
      border-bottom: 2px solid #f5a623;
      padding: 0.25rem 0.5rem;
      box-sizing: border-box;
    }
    thead tr {
      display: flex;
      flex-wrap: nowrap;
      width: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    thead tr th {
      display: flex;
      /* Breiten exakt wie tbody td, damit die Überschriften genau drüberstehen */
      &:nth-child(1) { flex-basis: 40%; min-width: 40%; max-width: 40%; }
      &:nth-child(2) { flex-basis: 15%; min-width: 15%; max-width: 15%; }
      &:nth-child(3) { flex-basis: 15%; min-width: 15%; max-width: 15%; }
      &:nth-child(4) { flex-basis: 15%; min-width: 15%; max-width: 15%; }
      &:nth-child(5) { flex-basis: 15%; min-width: 15%; max-width: 15%; }
      flex-grow: 0;
      flex-shrink: 0;
      padding: 0.25rem 0.5rem;
      border: none;
      font-weight: 600;
      color: #f5a623;
      border-right: 1px solid #444;
      min-width: 0;
      box-sizing: border-box;
      justify-content: flex-start;
      align-items: center;
    }
    thead tr th:last-child {
      border-right: none;
    }
    tbody tr.main-row {
      display: flex;
      flex-wrap: nowrap;
      padding: 0.25rem 0.5rem;
      border-bottom: 1px solid #333;
      position: relative;
      box-sizing: border-box;
    }
    tbody tr.main-row td {
      display: block;
      box-sizing: border-box;
      white-space: normal;
      overflow: visible;
      text-overflow: clip;
      vertical-align: middle;
      color: inherit;
      padding: 0.25rem 0.5rem;
      flex-grow: 0;
      flex-shrink: 0;
      /* Breiten exakt und passend zu thead */
    }
    tbody tr.main-row td:nth-child(1) {
      flex-basis: 40%;
      min-width: 40%;
      max-width: 40%;
      font-weight: 600;
    }
    tbody tr.main-row td:nth-child(2) {
      flex-basis: 15%;
      min-width: 15%;
      max-width: 15%;
    }
    tbody tr.main-row td:nth-child(3) {
      flex-basis: 15%;
      min-width: 15%;
      max-width: 15%;
    }
    tbody tr.main-row td:nth-child(4) {
      flex-basis: 15%;
      min-width: 15%;
      max-width: 15%;
    }
    tbody tr.main-row td:nth-child(5) {
      flex-basis: 15%;
      min-width: 15%;
      max-width: 15%;
      text-align: center;
    }
    tbody tr.note-row {
      display: none;
      background-color: #2a2a2a;
      border-bottom: 1px solid #333;
      box-sizing: border-box;
    }
    tbody tr.note-row.active {
      display: table-row;
    }
    tbody tr.note-row td {
      padding: 0.5rem 1rem;
      color: inherit;
      font-size: 0.9rem;
      white-space: normal;
      overflow-wrap: break-word;
      text-align: left;
    }
    .toggle-notes-button {
      font-size: 0.85rem;
      padding: 0.15rem 0.3rem;
      width: 1.3em;
      height: 1.3em;
      line-height: 1;
      border-radius: 3px;
      background-color: #f5a623;
      color: #121212;
      font-weight: bold;
      border: none;
      cursor: pointer;
      user-select: none;
      text-align: center;
      transition: background-color 0.3s;
    }
    .toggle-notes-button:hover,
    .toggle-notes-button:focus {
      background-color: #e09e1f;
      outline: none;
    }
    .notes-edit-textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #f5a623;
      background-color: #1a1a1a !important;
      font-family: inherit;
      font-size: 0.9rem;
      padding: 0.3rem 0.5rem;
      resize: vertical;
      color: inherit;
      transition: background-color 0.3s;
    }
    .notes-edit-textarea:focus {
      background-color: #333333 !important;
      outline: none;
    }
  }
  .clicked {
    background-color: #444 !important;
    color: #f5a623 !important;
  }
  tbody tr.clicked {
    color: #f5a623 !important;
  }
  tbody tr.note-row {
    display: none;
  }
  tbody tr.note-row.active {
    display: table-row;
  }
</style>
</head>
<body>
<div class="header-container">
  <h1>Mein Fitnessplan</h1>
  <button id="reset-storage-button" title="Alle gespeicherten Daten zurücksetzen">Zurücksetzen</button>
</div>
<table>
  <thead>
    <tr>
      <th>Übung</th>
      <th>Gerät</th>
      <th>Wdh.</th>
      <th>kg</th>
      <th>Notizen</th>
    </tr>
  </thead>
  <tbody id="table-body"></tbody>
</table>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    function safeParseJSON(key, fallback) {
      try {
        const item = localStorage.getItem(key);
        if (!item) return fallback;
        return JSON.parse(item);
      } catch {
        return fallback;
      }
    }

    const exercises = [
      { name: "Beinpresse", device: "30", wdh: "1", kg: "70", notes: "Lehne ganz nach hinten, Füße schulterbreit in der Mitte der Auflage platzieren, Fußspitzen zeigen leicht nach außen" },
      { name: "Adduktor", device: "25", wdh: "2", kg: "55", notes: "Außen auf 3 setzen" },
      { name: "Abduktor", device: "24", wdh: "2", kg: "55", notes: "Auf 1 setzen" },
      { name: "Latzug", device: "48/41", wdh: "1", kg: "50", notes: "Schultern mit herunternehmen, Ellenbogen leicht vor dem Körper halten, Zug zur Hüfte, mittlerer 3D Griff-nicht den ganz breiten" },
      { name: "Rudern", device: "4/41", wdh: "1", kg: "40", notes: "Ellenbogen eng am Körper, Zug zur Hüfte" },
     // { name: "v2Kabelzug enger Griff", device: "4/41", wdh: "1", kg: "45", notes: "Ellenbogen eng am Körper, Zug zur Hüfte" },
      { name: "Brustpresse", device: "63", wdh: "1", kg: "35", notes: "Horizontaler Griff, Ins Hohlkreuz setzen, Schulterblätter an der Lehne fixieren, Schultern unten lassen" },
      { name: "Butterfly", device: "52", wdh: "1", kg: "35", notes: "Griffe auf Brusthöhe, ins Hohlkreuz setzen, Schulterblätter an der Lehne fixieren, Schultern unten lassen" },
      { name: "Seitheben", device: "66", wdh: "1", kg: "25", notes: "Drehgelenk auf Schulterhöhe, Gewicht wird „aus dem Ellenbogen geführt“" },
      { name: "Butterfly reverse", device: "51", wdh: "1", kg: "30", notes: "Schultern unten lassen, Arme nur so weit nach hinten bewegen bis eine gerade Linie mit dem Rücken entsteht, hinten kurz halten" },
      { name: "Rückenstrecker", device: "43", wdh: "1", kg: "40", notes: "Rückenrolle Stufe 4, das davor Stufe 8, Beine zwischen 5 und 6" },
      { name: "Bauch", device: "77", wdh: "1", kg: "10", notes: "Schulter auf höhe der armstützen" }
    ];

    let clickedRows = safeParseJSON("clickedRows", []);
    let expandedNotes = safeParseJSON("expandedNotes", []);
    let wdhValues = safeParseJSON("wdhValues", {});
    let kgValues = safeParseJSON("kgValues", {});
    let notesTexts = safeParseJSON("notesTexts", {});

    expandedNotes = expandedNotes.filter((i) => i >= 0 && i < exercises.length);

    const tbody = document.getElementById("table-body");
    tbody.innerHTML = "";

    function createCell(content, className, rowIndex) {
      const td = document.createElement("td");
      if (className) td.className = className;
      if (rowIndex !== undefined) {
        td.setAttribute("data-row-index", rowIndex);
      }
      td.textContent = content;
      return td;
    }

    function updateStorage() {
      localStorage.setItem("expandedNotes", JSON.stringify(expandedNotes));
    }

    exercises.forEach((ex, i) => {
      const trMain = document.createElement("tr");
      trMain.classList.add("main-row");
      if (clickedRows.includes(i)) trMain.classList.add("clicked");

      function getRowTextColor() {
        if (trMain.classList.contains("clicked")) {
          return "#f5a623";
        }
        return i % 2 === 0 ? "#e0e0e0" : "#e0e0e0";
      }
      trMain.style.color = getRowTextColor();

      const tdName = createCell(ex.name, "", i);
      tdName.setAttribute("data-label", "Übung");
      trMain.appendChild(tdName);

      const tdDevice = createCell(ex.device);
      tdDevice.setAttribute("data-label", "Geräte-Nr.");
      trMain.appendChild(tdDevice);

      const wdhVal = wdhValues.hasOwnProperty(i) ? wdhValues[i] : ex.wdh;
      const tdWdh = createCell(wdhVal, "wdh-cell", i);
      tdWdh.setAttribute("data-label", "Wdh.");
      trMain.appendChild(tdWdh);

      const kgVal = kgValues.hasOwnProperty(i) ? kgValues[i] : ex.kg;
      const tdKg = createCell(kgVal, "kg-cell", i);
      tdKg.setAttribute("data-label", "Startgewicht");
      trMain.appendChild(tdKg);

      const tdNotesBtn = document.createElement("td");
      tdNotesBtn.setAttribute("data-label", "Notizen");
      tdNotesBtn.style.textAlign = "center";

      const notesContainer = document.createElement("div");
      notesContainer.className = "notes-container";

      const noteText =
        notesTexts.hasOwnProperty(i) && notesTexts[i].trim() !== ""
          ? notesTexts[i].trim()
          : ex.notes.trim();

      if (noteText.length > 0) {
        const toggleButton = document.createElement("button");
        toggleButton.type = "button";
        toggleButton.className = "toggle-notes-button";
        toggleButton.textContent = expandedNotes.includes(i) ? "−" : "+";
        notesContainer.appendChild(toggleButton);

        toggleButton.addEventListener("click", (e) => {
          e.stopPropagation();
          const isActive = trNote.classList.contains("active");
          if (isActive) {
            trNote.classList.remove("active");
            toggleButton.textContent = "+";
            const idx = expandedNotes.indexOf(i);
            if (idx > -1) {
              expandedNotes.splice(idx, 1);
            }
          } else {
            trNote.classList.add("active");
            toggleButton.textContent = "−";
            if (!expandedNotes.includes(i)) {
              expandedNotes.push(i);
            }
          }
          updateStorage();
        });
      }
      tdNotesBtn.appendChild(notesContainer);

      trMain.appendChild(tdNotesBtn);

      tbody.appendChild(trMain);

      const trNote = document.createElement("tr");
      trNote.classList.add("note-row");
      if (expandedNotes.includes(i)) {
        trNote.classList.add("active");
      }

      const tdNote = document.createElement("td");
      tdNote.colSpan = 5;
      tdNote.className = "notes-content";

      tdNote.textContent = noteText;

      function updateNoteColor() {
        let noteColor = getRowTextColor();
        tdNote.style.color = noteColor;
      }
      updateNoteColor();

      trNote.appendChild(tdNote);
      tbody.appendChild(trNote);

      tdWdh.addEventListener("click", (e) => {
        if (tdWdh.querySelector("input")) return;
        const inputEdit = document.createElement("input");
        inputEdit.type = "number";
        inputEdit.min = 1;
        inputEdit.max = 3;
        inputEdit.value = wdhVal;
        inputEdit.className = "wdh-input";
        inputEdit.style.width = "2em";
        inputEdit.style.color = getRowTextColor();
        inputEdit.style.backgroundColor = "transparent";
        inputEdit.style.border = "none";
        tdWdh.textContent = "";
        tdWdh.appendChild(inputEdit);
        inputEdit.focus();

        function saveValue() {
          let newVal = inputEdit.value.trim();
          if (!["1", "2", "3"].includes(newVal)) newVal = "1";
          wdhValues[i] = newVal;
          localStorage.setItem("wdhValues", JSON.stringify(wdhValues));
          tdWdh.textContent = newVal;
          tdWdh.style.color = getRowTextColor();
        }

        inputEdit.addEventListener("blur", saveValue);
        inputEdit.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter") inputEdit.blur();
          if (ev.key === "Escape") {
            tdWdh.textContent = wdhVal;
            tdWdh.style.color = getRowTextColor();
          }
        });
        e.stopPropagation();
      });

      tdKg.addEventListener("click", (e) => {
        if (tdKg.querySelector("input")) return;
        const inputEdit = document.createElement("input");
        inputEdit.type = "number";
        inputEdit.min = 10;
        inputEdit.max = 99;
        inputEdit.value = kgVal;
        inputEdit.className = "kg-input";
        inputEdit.style.width = "3em";
        inputEdit.style.color = getRowTextColor();
        inputEdit.style.backgroundColor = "transparent";
        inputEdit.style.border = "none";
        tdKg.textContent = "";
        tdKg.appendChild(inputEdit);
        inputEdit.focus();

        function saveValue() {
          let newVal = inputEdit.value.trim();
          if (!/^[0-9]{2}$/.test(newVal) || Number(newVal) < 10 || Number(newVal) > 99)
            newVal = ex.kg;
          kgValues[i] = newVal;
          localStorage.setItem("kgValues", JSON.stringify(kgValues));
          tdKg.textContent = newVal;
          tdKg.style.color = getRowTextColor();
        }

        inputEdit.addEventListener("blur", saveValue);
        inputEdit.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter") inputEdit.blur();
          if (ev.key === "Escape") {
            tdKg.textContent = kgVal;
            tdKg.style.color = getRowTextColor();
          }
        });
        e.stopPropagation();
      });

      trMain.addEventListener("click", (e) => {
        const ignoreTags = ["input", "button"];
        if (ignoreTags.includes(e.target.tagName.toLowerCase())) return;

        const cell = e.target.closest("td");
        if (!cell) return;
        const cellIndex = Array.from(cell.parentNode.children).indexOf(cell);
        if (cellIndex === 0 || cellIndex === 1) {
          trMain.classList.toggle("clicked");
          clickedRows = Array.from(
            document.querySelectorAll("tbody tr.main-row.clicked")
          ).map((row) => Array.from(tbody.children).indexOf(row) / 2 | 0);
          localStorage.setItem("clickedRows", JSON.stringify(clickedRows));
          trMain.style.color = getRowTextColor();
          updateNoteColor();
        }
      });

      tdNote.addEventListener("click", (e) => {
        e.stopPropagation();
        if (tdNote.querySelector("textarea")) return;

        const currentText = tdNote.textContent.trim();
        tdNote.textContent = "";

        const textarea = document.createElement("textarea");
        textarea.className = "notes-edit-textarea";
        textarea.value = currentText;
        textarea.rows = 4;
        textarea.style.color = getRowTextColor();
        textarea.style.backgroundColor = "#1a1a1a";
        tdNote.appendChild(textarea);
        textarea.focus();

        function saveNote() {
          const newText = textarea.value.trim();
          notesTexts[i] = newText;
          localStorage.setItem("notesTexts", JSON.stringify(notesTexts));
          tdNote.textContent = newText;
          textarea.remove();
          tdNote.style.color = getRowTextColor();
        }

        textarea.addEventListener("blur", saveNote);
        textarea.addEventListener("keydown", (ev) => {
          if (ev.key === "Enter" && !ev.shiftKey) {
            ev.preventDefault();
            textarea.blur();
          }
          if (ev.key === "Escape") {
            tdNote.textContent = currentText;
            textarea.remove();
            tdNote.style.color = getRowTextColor();
          }
        });
      });
    });

    document
      .getElementById("reset-storage-button")
      .addEventListener("click", () => {
        localStorage.removeItem("clickedRows");
        localStorage.removeItem("expandedNotes");
        localStorage.removeItem("wdhValues");
        localStorage.removeItem("kgValues");
        localStorage.removeItem("notesTexts");
        location.reload();
      });
  });
</script>
</body>
</html>




